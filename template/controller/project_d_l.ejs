<% include top.ejs %>
  <div class="page-title">
    <div class="title-env">
      <h1 class="title">项目详细</h1>
      <p class="description">Project details</p>
    </div>
    <div class="breadcrumb-env">
      <ol class="breadcrumb bc-1"> <li> <a href="/controller/"><i class="fa-home"></i>首页</a> </li>
        <li>  <a href="/controller/project">项目列表</a></li>
        <li class="active"> <strong>项目详细</strong> </li>
      </ol>
    </div>
  </div>
<section class="mailbox-env">
				
				<div class="row">
					<!-- Inbox emails -->
					<div class="col-sm-10 mailbox-right">
							<!-- Email Title and Button Options -->
							<div class="mail-single-header">
								<h2>
									[<%= project[3][0].name_zh %>]项目任务
								</h2>
								
								<div class="mail-single-header-options">
									<a href="/controller/project" class="btn btn-gray btn-icon">
										<span>返回</span>
										<i class="fa-reply-all"></i>
									</a>
								</div>
							</div>
					 
				<%if(project[2].length!==0){%>
						
						
				<% for(var i=0;i<project[2].length;i++){	%>	
						
				<!--员工列表-->
				<%if(project[3][0].type=='personnel'){%>		
				  <div class="panel col-sm-12 panel-default">
					<a href="/controller/project/project_d_lc/?id=<%= project[2][i].id %>&t_number=<%= project[2][i].t_number %>&p_number=<%= project[2][i].p_number %>" target="_self">
					<div class="col-sm-6 border_right ">
					  <h3 class="row padding_b10"><%= project[2][i].t_name %></h3>
					  <div class="row">
						 <p class="col-sm-3 padding-left-0">项目名称：<%=results[i].project_name %></p>
						 <p class="col-sm-9">任务周期：<%= results[i].from %>  至  <%= results[i].to %>  共<%= results[i].cycle %>天</p>
					  </div>
					  <p class="row">任务内容:<%= project[2][i].detailed %></p>
					</div>
					<div class="col-sm-2 border_right">
					  <h4 class="col-sm-12 padding_b10">任务状态</h4>
					  <p class="col-sm-12">剩余时间：<b><%= results[i].last %> 天</b></p>
					  <p class="col-sm-12">当前进度：<b><%= project[2][i].t_plan %>%</b></p>
					  <p class="col-sm-12">当前状态：任务结束</p>
					</div>
					<div class="col-sm-2 border_right">
					  <h4 class="col-sm-12 padding_b10">实际状态</h4>
					  <p class="col-sm-12">驳回次数：<b>0</b>次</p>
					  <p class="col-sm-12">实际耗时：<b><%= project[2][i].consuming %> H</b></p>
					  <p class="col-sm-12">推迟次数：<b>0</b> 次</p>
					</div>
					<div class="col-sm-2">
						<% if(project[2][i].state=="end"  || project[2][i].state=="ing"){%>
					  <canvas id="chart-area_<%= project[2][i].id %>"></canvas>

						<%}%>
					</div>
					</a>  
				  </div>
				<% }else{%>		
						
				<!--主管列表-->	
				<div class="panel col-sm-12 panel-default">
					<a href="/controller/project/project_d_lc/?id=<%= project[2][i].id %>&t_number=<%= project[2][i].t_number %>&p_number=<%= project[2][i].p_number %>" target="_self">
					<div class="col-sm-8 border_right ">
					  <h3 class="row padding_b10"><%= project[2][i].t_name %></h3>
					  <div class="row">
						 <p class="col-sm-3 padding-left-0">项目名称：<%=results[i].project_name %></p>
						 <p class="col-sm-9">任务周期：<%= results[i].from %>  至  <%= results[i].to %>  共<%= results[i].cycle %>天</p>
					  </div>
					  <p class="row">任务内容:<%= project[2][i].detailed %></p>
					</div>
					<div class="col-sm-2 border_right">
					  <h4 class="col-sm-12 padding_b10">任务状态</h4>
					  <p class="col-sm-12">剩余时间：<b><%= results[i].last %> 天</b></p>
					  <p class="col-sm-12">当前进度：<b><%= project[2][i].t_plan %>%</b></p>
					  <p class="col-sm-12">当前状态：任务结束</p>
					</div>
					 
					<div class="col-sm-2">
						<% if(project[2][i].state=="end"  ||  project[2][i].state=="ing"){%>
					  <canvas id="chart-area_<%= project[2][i].id %>"></canvas>

						<%}%>
					</div>
					</a>  
				  </div>		
						
				<% }%>		
				  <% }%>
						
						
						
				<% }else{%>	
					<h5 class="panel col-sm-12 panel-default">
						小伙伴，还没有完成的任务！
						</h5>	
				 <% }%>	
					</div>
					
					<!-- Mailbox Sidebar -->
					<!-- Mailbox Sidebar -->
					<div class="col-sm-2 mailbox-left">
						
						<div class="mailbox-sidebar">
							
							<a href="/controller/project/project_detailed?p_number=<%=project[0][0].p_number%>" class="btn btn-block btn-secondary btn-icon btn-icon-standalone btn-icon-standalone-right">
								<i class="linecons-mail"></i>
								<span>项目</span>
							</a>
							<ul class="list-unstyled mailbox-list">
								<li class="active">
									<a href="/controller/project/project_detailed?p_number=<%=project[0][0].p_number%>" target="_self">
										项目详细
									</a>
								</li>
							</ul>
							 
							<ul class="list-unstyled mailbox-list">

								<li class="list-header" >项目任务</li>
								<%for (var i=0;i<project[1].length;i++){%>
									<li>
										<a href="/controller/project/project_d_l?username=<%=project[1][i].username%>&p_number=<%=project[0][0].p_number%>" target="_self">
											<%=project[1][i].name_zh%>
										</a>
									</li>
								<%}%>
							</ul>
							<ul class="list-unstyled mailbox-list">

								<li class="list-header" >项目总结</li>
								<%for (var i=0;i<project[1].length;i++){%>
									<li>
										<a href="/controller/project/project_d_z?p_number=<%=project[0][0].p_number%>&username=<%=project[1][i].username%>" target="_self">
											<%=project[1][i].name_zh%>
										</a>
									</li>
								<%}%>
								
							</ul>
						</div>
					</div>
				</div>
				
			</section>	
  
  
  <!-- Main Footer --> 
  <!-- Choose between footer styles: "footer-type-1" or "footer-type-2" --> 
  <!-- Add class "sticky" to  always stick the footer to the end of page (if page contents is small) --> 
  <!-- Or class "fixed" to  always fix the footer to the end of page -->
      <% include footer.ejs %>
  </div>
</div>
<div class="modal fade custom-width" id="modal-2">
  <div class="modal-dialog" style="width: 60%;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">项目时间表</h4>
      </div>
      <div class="modal-body"> 时间表图片 </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
      </div>
    </div>
  </div>
</div>

<!-- Imported styles on this page -->
<link rel="stylesheet" href="/www/assets/js/daterangepicker/daterangepicker-bs3.css">
<link rel="stylesheet" href="/www/assets/js/select2/select2.css">
<link rel="stylesheet" href="/www/assets/js/select2/select2-bootstrap.css">
<link rel="stylesheet" href="/www/assets/js/multiselect/css/multi-select.css">

<!-- Bottom Scripts --> 
<script src="/www/assets/js/bootstrap.min.js"></script> 
<script src="/www/assets/js/TweenMax.min.js"></script> 
<script src="/www/assets/js/resizeable.js"></script> 
<script src="/www/assets/js/joinable.js"></script> 
<script src="/www/assets/js/xenon-api.js"></script> 
<script src="/www/assets/js/xenon-toggles.js"></script> 
<script src="/www/assets/js/moment.min.js"></script> 

<!-- Imported scripts on this page --> 
<script src="/www/assets/js/daterangepicker/daterangepicker.js"></script> 
<script src="/www/assets/js/datepicker/bootstrap-datepicker.js"></script> 
<script src="/www/assets/js/timepicker/bootstrap-timepicker.min.js"></script> 
<script src="/www/assets/js/colorpicker/bootstrap-colorpicker.min.js"></script> 
<script src="/www/assets/js/select2/select2.min.js"></script> 
<script src="/www/assets/js/jquery-ui/jquery-ui.min.js"></script> 
<script src="/www/assets/js/selectboxit/jquery.selectBoxIt.min.js"></script> 
<script src="/www/assets/js/tagsinput/bootstrap-tagsinput.min.js"></script> 
<script src="/www/assets/js/typeahead.bundle.js"></script> 
<script src="/www/assets/js/handlebars.min.js"></script> 
<script src="/www/assets/js/multiselect/js/jquery.multi-select.js"></script> 
<!-- chart --> 
<script src="/www/assets/js/chart/Chart.bundle.js"></script> 
<script src="/www/assets/js/chart/utils.js"></script> 
<script type="text/javascript">
	 
			var randomScalingFactor = function() {
			return Math.round(Math.random() * 100);
		};
    <% for(var i=0;i<project[2].length;i++){	%>	
	    <% if(project[2][i].state=="end" || project[2][i].state=="ing" ){%>	
		var config<%= project[2][i].id %> = {
			type: 'doughnut',
			data: {
				datasets: [{
					data: [
						<%= results[i].unfinished %>, 
						<%= project[2][i].t_plan %>,
					],
					backgroundColor: [
						window.chartColors.red,
						window.chartColors.blue,
					],
					label: 'Dataset 1'
				}],
				labels: [
					'未完成',
					'完成',
				]
			},
			options: {
					responsive: true,
					legend: {
					position:'right',
					display: false,
				},
				title: {
					display: false,
					text: 'Chart.js Doughnut Chart'
				},
				animation: {
					animateScale: true,
					animateRotate: true
				}
			}
		};
		<%}%>	
<%}%>	
		$(function($) {
		    <% for(var i=0;i<project[2].length;i++){	%>	
				<% if(project[2][i].state=="end"  || project[2][i].state=="ing"){%>		
					var ctx<%= project[2][i].id %> = document.getElementById('chart-area_<%= project[2][i].id %>').getContext('2d');
					window.myDoughnut = new Chart(ctx<%= project[2][i].id %>, config<%= project[2][i].id %>);
				<%}%>	
		<%}%>
		});
	
		var colorNames = Object.keys(window.chartColors);
			
 
	</script> 
<!-- JavaScripts initializations and stuff --> 
<script src="/www/assets/js/xenon-custom.js"></script>
</body>
</html>

